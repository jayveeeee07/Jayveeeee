<!doctype html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Booking</title><link rel="stylesheet" href="/style.css"></head><body><header class="header"><a class="brand" href="/home.html"><img src="/images/logo.jpg"><div><h1>JAYVEE HALL OF MANSION</h1></div></a></header><main class="container"><section class="card"><h2>Reservation Form</h2><div id="roomDetails" class="card"></div><form id="bookingForm"><label>Full Name</label><input class="input" name="fullName" required><label>Date Check In</label><input class="input" type="date" name="checkIn" required><label>Payment Method</label><select class="input" name="paymentMethod" required><option value=''>--Select--</option><option value='cash'>Cash</option><option value='online'>Online</option></select><label>Proof (if online)</label><input class="input" type="file" name="proof" accept="image/*"><label>Reference</label><input class="input" id="ref" name="reference" readonly><div class="form-actions"><button class="btn btn-outline" type="button" id="genRef">Generate Reference</button><button class="btn btn-outline" type="button" id="reviewBtn">Review</button><button class="btn btn-primary" type="submit">Confirm</button></div></form></section></main><div class='modal-backdrop' id='reviewModal'><div class='modal'><h3>Review Booking</h3><div id='modalContent'></div><div class='modal-actions'><button class='btn btn-outline' id='editBtn'>Edit</button><button class='btn btn-primary' id='confirmBtn'>Confirm</button></div></div></div><script>let roomId=new URLSearchParams(location.search).get('room');async function loadRoom(){if(!roomId){document.getElementById('roomDetails').innerHTML='No room selected';return;}const res=await fetch('/api/get_rooms.php');const j=await res.json();const r=j.rooms.find(x=>String(x.id)===String(roomId));if(!r){document.getElementById('roomDetails').innerHTML='Room not found';return;}document.getElementById('roomDetails').innerHTML=`<img src='${r.image}' style='width:100%;max-width:320px;border-radius:8px;'><div><strong>Room:</strong> ${r.name} (${r.room_number})</div><div><strong>Price:</strong> â‚± ${Number(r.price).toLocaleString()}</div>`;window.selectedRoom=r;}document.getElementById('genRef').addEventListener('click',()=>document.getElementById('ref').value='REF-'+Math.random().toString(36).slice(2,9).toUpperCase());document.getElementById('reviewBtn').addEventListener('click',()=>{const f=document.getElementById('bookingForm');if(!f.fullName.value||!f.checkIn.value||!f.paymentMethod.value){alert('Fill required fields');return;}const html=`<div><strong>Room:</strong> ${window.selectedRoom.name} (${window.selectedRoom.room_number})</div><div><strong>Check-in:</strong> ${f.checkIn.value}</div><div><strong>Name:</strong> ${f.fullName.value}</div><div><strong>Payment:</strong> ${f.paymentMethod.value}</div><div><strong>Ref:</strong> ${document.getElementById('ref').value||'(not generated)'}</div>`;document.getElementById('modalContent').innerHTML=html;document.getElementById('reviewModal').classList.add('open');});document.getElementById('editBtn').addEventListener('click',()=>document.getElementById('reviewModal').classList.remove('open'));document.getElementById('confirmBtn').addEventListener('click',()=>document.querySelector('#bookingForm button[type=submit]').click());document.getElementById('bookingForm').addEventListener('submit',async e=>{e.preventDefault();const form=e.target;const fd=new FormData();fd.append('room_id',roomId);fd.append('check_in',form.checkIn.value);fd.append('payment_method',form.paymentMethod.value);fd.append('reference_number',document.getElementById('ref').value);if(form.proof.files[0])fd.append('proof',form.proof.files[0]);const res=await fetch('/api/book.php',{method:'POST',body:fd});const j=await res.json();if(j.success){alert('Booked!');location.href='/home.html';}else alert(j.error||'Error');});loadRoom();</script></body></html>
